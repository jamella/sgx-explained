\section{Overview}
\label{sec:intro}

Intel's Software Guard Extensions (SGX) is the latest iteration in a long line
of designs that aim to offer the ability of executing software on a computer
owned by an untrusted party, while at the same time providing some guarantees
about the privacy and integrity of the computation.

SGX implements a \textit{remote attestation model} similar to its predecessors,
TPM~\cite{grawrock2003tpm} and TXT~\cite{grawrock2009txt}. A system that is not
under the computation owner's control produces an attestation assuring the
computation owner that a protected environment (called \textit{enclave} in
Intel's literature) was set up on an SGX-enabled processor, according to the
computation owner's expectations. The attestation also includes information
used to set up a secure communication channel with the software running inside
the enclave.

SGX stands out from its predecessors by the amount of code covered by the
attestation, which is in the Trusted Computing Base (TCB) for the system using
hardware protection. The attestations produced by the original TPM design
covered all the software running on a computer, and TXT attestations covered
the code inside a VMX \cite{uhlig2005vmx} virtual machine. In SGX, an enclave
only contains the private data in a computation, and the code that operates on
it.

For example, a cloud service that performs image processing on confidential
medical images could be implemented by having users upload encrypted images.
The users would send the encryption keys to software running inside an enclave.
The enclave would contain the code for decrypting images, the image processing
algorithm, and the code for encrypting the results. The code that receives the
uploaded encrypted images and stores them would be left outside the enclave.

An SGX-enabled processor protects the integrity and privacy of the computation
inside an enclave by isolating the enclave's code and data from the outside
environment, including the operating system and hypervisor, and hardware
devices attached to the system bus. At the same time, the SGX model remains
compatible with the the traditional software layering in the Intel
architecture, where the OS kernel and hypervisor manage the computer's
resources.


\subsection{SGX Lightning Tour}
\label{sec:intro_sgx}

SGX sets aside a memory region, called the \textit{Processor Reserved Memory}
(PRM, \S~\ref{sec:prm}). The CPU protects the PRM from all non-enclave memory
accesses, including kernel, hypervisor and SMM (\S~\ref{sec:rings}) accesses,
and DMA accesses (\S~\ref{sec:motherboard}) from peripherals.

The PRM holds the \textit{Enclave Page Cache} (EPC, \S~\ref{sec:epc}), which
consists of 4KB pages that store enclave code and data. The system software,
which is untrusted, is in charge of assigning EPC pages to enclaves. The CPU
tracks each EPC page's state in the \textit{Enclave Page Cache Metadata} (EPCM,
\S~\ref{sec:epcm}), to ensure that each EPC page belongs to exactly one
enclave.

The initial code and data in an enclave is loaded by untrusted system software.
During the setup stage (\S~\ref{sec:lifecycle}), the system software asks the
CPU to copy data from unprotected memory (outside PRM) into EPC pages, and
assigns the pages to the enclave being setup (\S~\ref{sec:epcm}). This
means that the initial enclave state is known to the system software.

After all the enclave's pages are loaded into EPC, the system software asks the
CPU to mark the enclave as initialized, at which point application software can
run the code inside the enclave. After an enclave is initialized, the loading
method described above is disabled.



